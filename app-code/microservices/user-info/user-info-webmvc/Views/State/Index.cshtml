@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>
    var url = "http://localhost:5000/userinfo/api/v1/state";
    function loadInfo(){
        var options = {};
        options.url = url;
        options.type = "GET";
        options.dataType = "json";
        options.success = function (data) {
            $("#state-list").empty();
            data.forEach(function (element) {
                $("#state-list").append("<li>" 
                + element.id + "-" + element.name + "-" + element.countryData.name+ "</li>");
            });
        };
        options.error = function () {
            $("#msg").html("Error while calling the Web API!");
        };
        $.ajax(options);
    }

    function loadCountries() {
        var options = {};
            options.url = "http://localhost:5000/userinfo/api/v1/country";
            options.type = "GET";
            options.dataType = "json";
            options.success = function (data) {
                $("#countries").empty();
                data.forEach(function (element) {
                    $("#countries").append("<option value=" + element.id + ">" + element.name + "</option>");
                });
            };
            options.error = function () {
                $("#msg").html("Error while calling the Web API!");
            };
            $.ajax(options);
    }

        $(document).ready(function () {
            $("#insert").click(function () {
                var options = {};
                options.url = url;
                options.type = "POST";

                var obj = {};
                obj.name = $("#name").val();

                options.contentType = "application/json";
                options.dataType = "json";

                options.success = function (msg) {
                    $("#msg").html(msg);
                    loadInfo();
                };
                options.error = function () {
                    $("#msg").html("Error while calling the Web API!");
                };
                $.ajax(options);
            });

            $("#update").click(function () {
                var options = {};
                options.url = url + "/" +  $("#id").val();
                options.type = "PUT";

                var obj = {};
                obj.id = $("#id").val();
                obj.name = $("#name").val();

                options.data = JSON.stringify(obj);
                options.contentType = "application/json";
                options.dataType = "json";
                options.success = function (msg) {
                    $("#msg").html(msg);
                    loadInfo();
                };
                options.error = function (a, b, c) {
                    $("#msg").html("Error while calling the Web API!");
                };
                $.ajax(options);
            });
    
            $("#delete").click(function () {
                var options = {};
                options.url = url + "/" +  $("#id").val();
                options.type = "DELETE";
                options.datatype = "json";
                options.success = function (msg) {
                    $("#msg").html(msg);
                    loadInfo();
                };
                options.error = function (a, b, c) {
                    $("#msg").html("Error while calling the Web API!");
                };
                $.ajax(options);
            });
            loadCountries();

       loadInfo();
    });
</script>
<h1>State List</h1>
<p id="msg"></p>
<div id="state-list"></div>
<form>
    <table border="1">
        <tr>
            <td>Id:</td>
            <td><input id="id" type="text" /></td>
        </tr>
        <tr>
            <td>State :</td>
            <td><input id="name" type="text" /></td>
        </tr>
        <tr>
            <td>Country:</td>
            <td><select id="countries"></select></td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="button" id="insert" 
                       value="Insert" />
                <input type="button" id="update" 
                       value="Update" />
                <input type="button" id="delete" 
                       value="Delete" />
            </td>
        </tr>
    </table>
    <br />
    <div id="msg"></div>
</form>
